---
title: "Group3"
group members:: "Hyewon Kim(01914937), SuYeon Kim (01916212), Taeeun Kim (019116203), Yoonyoung Jeong (02015025)"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  html_document:
    highlight: tango
    self_contained: true
    theme: paper
    toc: no
    df_print: kable
    fig_caption: no
    number_sections: no
    smart: yes
    dev: svg
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE, eval = TRUE, fig.width = 6, warning = FALSE,
  message = FALSE,
  fig.asp = 0.618, out.width = "80%", dpi = 120,
  fig.align = "center", cache = FALSE
)

# Load necessary libraries
suppressPackageStartupMessages(library(moments))
suppressPackageStartupMessages(library(epiDisplay))
suppressPackageStartupMessages(library(vioplot))
suppressPackageStartupMessages(library(zoo))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(faraway))
suppressPackageStartupMessages(library(ggplot2))
```

# 1. Brief background
- Age: the age of the gorilla
- Mean_CORT\_(ng/g)\_B_Total: FGM level
- GrpType: Group type (either One-male or Multi_Male)
- Monthly_rain_mm_Bisate: amount of rainfall (in mm) in the month that the sample was collected.
    
<br />

# 2. Data sets
- Bovine
  - Antibiotic: the antibiotic that was administered.
  - Cow_no: a numerical ID, identifying the cow that the antibiotic was administered to.
-- Per_bound: a measure for the amount of binding of the antibiotic with serum of the cow.

- Ovine
  - Antibiotic: the antibiotic that was administered.
  - Conc: concentration of the antibiotic (in µg/ml).
  - Per_bound: a measure for the amount of binding of the antibiotic with serum of the cow.

# 3. Research Question
- 1. Do different antibiotics bind at different rates to serum proteins?
- 2. For the ovine dataset, is there an association between the concentration of antibiotic that was administered, and the percentage that is bound to the serum?

<br />

# 4. Instructions \*\*

## \*\* 4.1 Exploratory data analysis \*\*

### 4.1.1
- Read in the datasets and provide a summary of the percentage bound for both datasets.
- What is the mean, median, minimum and maximum? Display your results as a (nicely
typeset) table.

```{r}
# Read the datasets
ovine <- read.csv("ovine.csv", header = TRUE, sep = ',', dec = '.')
bovine <- read.csv("bovine.csv", header = TRUE, sep = ',', dec = '.')
```

```{r}
# Calculate summary statistics for 'Per_bound' column
ovine_summary <- summary(ovine$Per_bound)
bovine_summary <- summary(bovine$Per_bound)
```

```{r}
# Get the mean, median, min, and max for ovine
ovine_stats <- c(mean = mean(ovine$Per_bound, na.rm = TRUE),
                 median = median(ovine$Per_bound, na.rm = TRUE),
                 min = min(ovine$Per_bound, na.rm = TRUE),
                 max = max(ovine$Per_bound, na.rm = TRUE))
```

```{r}
# Get the mean, median, min, and max for bovine
bovine_stats <- c(mean = mean(bovine$Per_bound, na.rm = TRUE),
                  median = median(bovine$Per_bound, na.rm = TRUE),
                  min = min(bovine$Per_bound, na.rm = TRUE),
                  max = max(bovine$Per_bound, na.rm = TRUE))
```

```{r}
# Combine into a data frame for nice table format
summary_table <- data.frame(
  Statistic = c("mean", "median", "min", "max"),
  Ovine = ovine_stats,
  Bovine = bovine_stats
)
```

```{r}
# Print the table
print(summary_table)
```

### 4.1.2
- For each dataset, make a plot that shows the distribution of percentage bound for each antibiotic.
- Use these plots to discuss whether there is a noticeable difference in percentage bound for each antibiotic.


```{r}
# Create a plot for the ovine dataset
ovine_plot <- ggplot(ovine, aes(x = Antibiotic, y = Per_bound, fill = Antibiotic)) +
  geom_boxplot() +
  labs(title = "Distribution of Percentage Bound for Each Antibiotic in Ovine",
       x = "Antibiotic",
       y = "Percentage Bound") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Create a plot for the bovine dataset
bovine_plot <- ggplot(bovine, aes(x = Antibiotic, y = Per_bound, fill = Antibiotic)) +
  geom_boxplot() +
  labs(title = "Distribution of Percentage Bound for Each Antibiotic in Bovine",
       x = "Antibiotic",
       y = "Percentage Bound") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Print the plots
print(ovine_plot)
print(bovine_plot)
```

### 4.1.3
- For each dataset, investigate whether the percentage bound for each antibiotic is normally distributed.
- You can use whichever approach you think is reasonable for this question, but
in particular consider the number of data points per antibiotic.
- Is there a lot of data, or not? How does this affect your assessment of normality?

```{r}
# Function to perform normality assessment for each antibiotic
normality_assessment <- function(df, dataset_name) {
  results <- data.frame(Antibiotic = character(),
                        Shapiro_Wilk_p_value = numeric(),
                        Sample_Size = integer(),
                        Mean = numeric(),
                        Median = numeric(),
                        Skewness = numeric(),
                        Kurtosis = numeric(),
                        stringsAsFactors = FALSE)
  
  for (antibiotic in unique(df$Antibiotic)) {
    data_subset <- df %>% 
      filter(Antibiotic == antibiotic) %>%
      select(Per_bound)
      
    shapiro_test <- shapiro.test(data_subset$Per_bound)
    n <- nrow(data_subset)
    skewness <- e1071::skewness(data_subset$Per_bound)
    kurtosis <- e1071::kurtosis(data_subset$Per_bound)
    
    results <- rbind(results, data.frame(Antibiotic = antibiotic,
                                         Shapiro_Wilk_p_value = shapiro_test$p.value,
                                         Sample_Size = n,
                                         Mean = mean(data_subset$Per_bound),
                                         Median = median(data_subset$Per_bound),
                                         Skewness = skewness,
                                         Kurtosis = kurtosis))
  }
  
  results$Dataset <- dataset_name
  return(results)
}
```

```{r}
# Assess normality for ovine and bovine datasets
ovine_normality <- normality_assessment(ovine, "Ovine")
bovine_normality <- normality_assessment(bovine, "Bovine")

```

```{r}
# Combine the results
normality_results <- rbind(ovine_normality, bovine_normality)
```

```{r}
# Print the results
print(normality_results)
```

### 4.1.4
- For the ovine dataset, investigate whether there is an association between the concentration of the antibiotic and the percentage bound.
- To this end, make a scatter plot of Conc versus Per_bound, and color the markers by Antibiotic. What are your conclusions?

```{r}
# Create a scatter plot of Conc versus Per_bound, colored by Antibiotic
scatter_plot <- ggplot(ovine, aes(x = Conc, y = Per_bound, color = Antibiotic)) +
  geom_point(alpha = 0.7) +  # Use alpha to make points slightly transparent
  labs(title = "Scatter Plot of Concentration vs. Percentage Bound in Ovine",
       x = "Concentration",
       y = "Percentage Bound") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_color_brewer(palette = "Set1")  # Use a color palette that's distinct
```

```{r}
# Print the scatter plot
print(scatter_plot)
```

## \*\* 4.2 Hypothesis testing \*\*

### 4.2.1 bovine dataset:

#### 4.2.1.1
- What test would you use to establish whether there is a significant difference in percentage bound between the different antibiotics?
- 다양한 항생제 그룹 간 백분율 차이를 검정하기 위해서 ANOVA 분산분석을 사용

- Name the test, describe your reasons for using it, and state the null and alternative hypotheses in terms that are appropriate for the problem at hand.
- 귀무가설 (H0) : 다른 항생제 간에 백분율 차이가 없다.
- 대립가설 (H1) : 적어도 하나의 항생제 그룹에서 백분율 차이가 있다.

#### 4.2.1.2
- Discuss whether the assumptions for the test are satisfied, perform the test, and report your findings (again using terms that are appropriate for the given problem).
- 

```{r}
aovRes = aov(Per_bound ~ Antibiotic, data = bovine)
summary(aovRes)
```


#### 4.2.1.3
- If you think it is appropriate, perform a post-hoc analysis to find differences in percentage bound between different antibiotics. Report your findings.
- A)

```{r}
thkRes = TukeyHSD(aovRes)
thkRes
plot(thkRes)
```

### 4.2.2 ovine dataset:

#### 4.2.2.1
- Investigate whether there is a significant relation between the concentration of antibiotics and the percentage bound. You do not need to separate the dataset by antibiotic.


#### 4.2.2.2
- Suppose you now want to test the association between concentration and percentage bound for each antibiotic separately.
- What would you do to address the problem of multiple testing? You don’t need to run the tests, a brief description of the procedure is sufficient.


## \*\* 4.3 Interpretation and conclusions \*\*

### 4.3.1
- Write a short paragraph formulating your answers to the research questions that were posed at the beginning of the project.
- Write your conclusions in such a way that a nonstatistician can understand them.


### 4.3.2
- Take another look at the bovine dataset, and at the Cow_no column in particular. - Do you notice anything that could jeopardize your findings from before? What would you do to alleviate it?